# 产品需求文档 (Product Specification)

## 项目概述

**项目名称**：LaoChenDNS

**一句话描述**：一个本地 DNS 聚合管理工具，通过 Cloudflare 与 DNSPod 的 API 统一管理多域名解析记录，减少多平台登录与记忆成本。

**目标**：让个人站长在一个界面内完成域名聚合查看与解析记录管理，避免频繁登录/MFA、跨网络环境切换（VPN）带来的操作成本与出错风险。

## 目标用户

**核心用户群体**：个人站长（管理多个站点/域名，域名分散在不同 DNS 厂商）。

**用户特征**：
- 年龄段：18-45
- 技术水平：能理解 DNS 记录类型与基本解析概念，愿意使用工具提升效率
- 使用场景：多域名日常维护（新增解析、修改 TTL、验证 TXT 等），偶发故障排查
- 痛点：域名分散在不同厂商；每次登录需要 MFA/重复验证；还要记忆域名在哪家；不同网络环境（部分厂商需 VPN）切换麻烦且易出错

## 核心功能

### 功能 1：多厂商接入与授权管理

**功能描述**：用户在本地一次性配置 Cloudflare 与 DNSPod 的 API 凭据，工具完成连通性校验并安全保存，后续无需重复登录即可调用厂商 API 管理解析记录。

**输入**：
- 厂商类型：Cloudflare / DNSPod
- Cloudflare 账号邮箱：[字符串，示例：user@example.com]
- Cloudflare Global API Key：[字符串，示例：xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
- DNSPod Token ID：[数字字符串，示例：123456]
- DNSPod Token：[字符串，示例：xxxxxxxxxxxxxxxx]
- 主密码（用于本地加密存储）：[字符串，示例：CorrectHorseBatteryStaple]

**输出**：
- 接入状态：[成功/失败]
- 失败原因：[鉴权失败/网络错误/限流/未知错误]
- 已保存的厂商接入配置：[Cloudflare 已配置/未配置；DNSPod 已配置/未配置]

**业务规则**：
- 不支持同一厂商多账号：Cloudflare 仅允许配置 1 组凭据；DNSPod 仅允许配置 1 组 Token
- 保存前必须完成鉴权校验：校验通过才允许落盘保存
- 凭据必须本地加密存储：未设置主密码时不允许进入“已配置”状态
- 主密码仅用于本地解密：工具不将主密码或凭据上传至任何远端

**异常处理**：
- 鉴权失败：提示用户检查邮箱/Key/Token 是否正确，并保持“未配置”状态
- 网络错误（含需 VPN 但不可达）：提示网络不可达与重试入口，不覆盖现有已保存配置
- API 限流：提示稍后重试，并在短时间内限制重复校验请求

**优先级**：高

**状态**：待开发

---

### 功能 2：域名列表聚合

**功能描述**：从已配置的厂商账号实时拉取域名（Zone）列表，统一展示在一个列表中，支持关键字搜索与按厂商筛选，降低“域名在哪家”的记忆成本。

**输入**：
- 刷新操作：[按钮/快捷键触发，示例：点击“刷新”]
- 搜索关键字：[字符串，示例：example]
- 厂商筛选：[Cloudflare / DNSPod / 全部]

**输出**：
- 聚合域名列表（每条包含）：
  - 域名：[字符串，示例：example.com]
  - 厂商：[Cloudflare/DNSPod]
  - 状态：[正常/鉴权失败/不可达/拉取失败]
  - 记录数：[整数，示例：42]
  - 最近变更时间：[时间戳或本地化时间字符串，示例：2026-01-31 21:30]

**业务规则**：
- 更新策略：每次进入列表或用户点击刷新时，实时拉取最新数据
- 搜索范围：仅匹配域名字段（支持子串匹配）
- 筛选范围：仅支持按厂商筛选（Cloudflare/DNSPod/全部）
- 记录数获取策略：优先使用厂商可用的统计信息；若需额外接口拉取，允许以“加载中/未知”占位并随后补全
- 状态判定：若某厂商鉴权失效或网络不可达，该厂商域名标记为失败状态，不影响另一厂商正常展示

**异常处理**：
- 部分厂商拉取失败：列表仍展示已成功部分，并在失败厂商处展示错误原因与重试入口
- 拉取超时：提示超时并允许重试，不清空上次成功缓存的展示（若存在）

**优先级**：高

**状态**：待开发

---

### 功能 3：解析记录 CRUD

**功能描述**：用户选择某个域名后，查看该域名在对应厂商下的解析记录，并支持新增、修改、删除单条记录；对“同名同类型记录冲突”提供可选策略（不创建/强制覆盖）。

**输入**：
- 域名选择：[从聚合列表进入，示例：example.com]
- 操作类型：[新增/修改/删除]
- 记录字段（通用）：
  - 记录类型：[A/AAAA/CNAME/TXT/MX/NS/SRV/CAA]
  - 主机记录（Name）：[字符串，示例：@ 或 www 或 _acme-challenge]
  - 记录值（Content）：[字符串，示例：1.2.3.4 或 target.example.com]
  - TTL：[整数秒，示例：120/300/600/3600]
- 记录字段（按类型）：
  - MX 优先级：[整数，示例：10]
  - SRV 优先级：[整数，示例：10]
  - SRV 权重：[整数，示例：5]
  - SRV 端口：[整数，示例：443]
  - CAA Flags：[整数，示例：0]
  - CAA Tag：[字符串，示例：issue/issuewild/iodef]
- 冲突策略（仅新增时）：
  - 不创建：[若存在同名同类型记录则拒绝创建]
  - 强制覆盖：[若存在同名同类型记录则更新为输入值]

**输出**：
- 操作结果：[成功/失败/部分成功]
- 失败原因：[字段校验失败/厂商拒绝/网络错误/限流/未知错误]
- 更新后的记录列表：[按列表展示，示例：若成功则包含新记录]

**业务规则**：
- 仅支持单条记录操作：MVP 不包含批量新增/批量修改/批量删除
- 字段校验：
  - A/AAAA：记录值必须是合法 IPv4/IPv6
  - CNAME：记录值必须是合法域名且建议以点结尾或由工具统一处理
  - TXT：支持包含空格与引号的内容，工具应按厂商要求进行转义/分段处理
  - MX/SRV/CAA：必须填写对应必填字段（如 MX 优先级、SRV 端口等）
- 冲突判定：以“同厂商、同域名、同记录类型、同主机记录（Name）”为冲突键
- 覆盖行为：强制覆盖时仅覆盖冲突键对应的目标记录（若厂商存在多条同键记录，工具需明确提示并要求用户选择目标或先清理）
- 异常处理选择：允许部分成功，向用户返回失败列表与重试入口

**异常处理**：
- 字段校验失败：在提交前阻止请求并提示具体字段与示例
- 厂商接口错误：展示厂商返回的可读错误信息，并提供重试
- 并发变更冲突：当远端记录已变化导致更新失败时，提示刷新后再操作

**优先级**：高

**状态**：待开发

---

## 功能优先级

### 高优先级（必须有）
1. 多厂商接入与授权管理 - 没有鉴权与安全保存，后续功能无法使用
2. 域名列表聚合 - 解决“域名在哪家”的核心痛点，降低切换与记忆成本
3. 解析记录 CRUD - 直接完成 DNS 日常维护的关键操作闭环

### 中优先级（应该有）
1. 连接状态健康检查 - 让用户快速知道是否需要 VPN/是否鉴权过期
2. 手动刷新与最近成功缓存展示 - 避免每次实时拉取造成等待与失败清空
3. 解析记录变更审计（本地） - 降低误操作风险，便于追溯

### 低优先级（可以有）
1. 同厂商多账号支持 - 复杂度上升，但能覆盖更多真实场景
2. 批量操作与模板套用 - 提升效率，但先在单条 CRUD 上验证模型
3. 记录对比与同步 - 能力强但冲突策略复杂，后置

## AI增强功能

### AI增强 1：解析记录生成与校验助手

**AI能力描述**：用户用自然语言描述需求（例如“把 www 指向 1.2.3.4，TTL 300，再加一条用于证书的 TXT”），AI 生成建议的记录集合与字段，并在提交前进行格式校验与风险提示。

**触发条件**：用户在记录管理页面点击“AI 帮我生成/校验”，或用户粘贴一段服务商提供的 DNS 配置说明文本。

**输入**：自然语言描述/配置说明文本、目标域名、厂商类型、当前记录列表（可选）。

**输出**：建议新增/修改/删除的记录草案、每条记录的解释与风险提示、可一键填充到新增/编辑表单。

**示例**：输入“为 example.com 配置 mail，MX 指向 mail.example.com 优先级 10，同时加 SPF TXT”，输出一条 MX + 一条 TXT 的可提交草案，并提示 TXT 可能需要分段或引号处理。

---

## 非功能性需求

### 性能要求
- 域名列表拉取：在网络正常且厂商接口可用时，首次拉取在 10 秒内返回可展示结果（允许分段加载）
- 记录列表拉取：进入域名记录页后 5 秒内展示首屏记录

### 安全要求
- 凭据本地加密存储：默认不以明文落盘，不在界面中明文展示完整 Key/Token
- 最小化日志：日志不得包含 Cloudflare Global API Key、DNSPod Token、主密码等敏感信息

### 可用性要求
- 厂商部分失败可用：任一厂商不可达/鉴权失败不影响另一厂商正常使用
- 明确错误提示：网络不可达、鉴权失败、限流等错误需可读且可操作（提供重试）

### 兼容性要求
- 支持 Windows（优先）
- 支持 IPv4/IPv6 记录管理（A/AAAA）

## 技术栈建议

### 前端
- 桌面 UI：Tauri + Web UI 或 Electron + Web UI（优先选择能良好支持系统密钥存储与自动更新的方案）

### 后端
- 本地 API/业务层：与桌面框架配套（Tauri/Rust 或 Node.js），封装 Cloudflare 与 DNSPod API

### 数据库
- 本地存储：SQLite 或 JSON 文件（凭据采用加密后存储）

### AI服务
- 可选：接入任意大模型 API（用于记录生成/校验），并提供开关与本地脱敏策略

## 附录

### 术语表
- Zone：DNS 厂商对“域名解析区域”的资源实体（通常对应一个域名）
- 记录（Record）：DNS 解析记录项（A/AAAA/CNAME/TXT/MX/NS/SRV/CAA 等）
- TTL：记录缓存时间（秒）

### 参考资料
- Cloudflare API 文档：https://developers.cloudflare.com/api/
- DNSPod API 文档：https://docs.dnspod.cn/

---

**文档版本**：0.1.0

**最后更新**：2026-01-31

**下次更新计划**：完成原型设计与字段细化后更新为 0.2.0
